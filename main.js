!function(){"use strict";class e{constructor(e,t,r,i,o,n){this._name=e.name,this._link=e.link,this._id=e._id,this.isLiked=e.isLiked,this._cardSelector=t,this._handleImageClick=r,this.domElements=i,this._handleDeleteCallback=o.bind(this),this._handleLikeCallback=n.bind(this)}getView(){const e=document.querySelector(this._cardSelector);return this._cardElement=e.content.querySelector(".card").cloneNode(!0),this._cardImageElement=this._cardElement.querySelector(".card__image"),this._cardTitleEl=this._cardElement.querySelector(".card__title"),this._cardImageElement.src=this._link,this._cardImageElement.alt=this._name,this._cardTitleEl.textContent=this._name,this._isLiked(),this._setEventListeners(),this._cardElement}_isLiked(){this._likeButton=this._cardElement.querySelector(".card__like-button"),this.isLiked&&this._likeButton.classList.add("card__like-button_active")}_setEventListeners(){this._cardElement.querySelector(".card__delete-button").addEventListener("click",(()=>{this._handleDeleteCallback(this._id,this._cardElement)})),this._cardElement.querySelector(".card__like-button").addEventListener("click",(()=>{this._handleLikeCallback(this._id,this._cardElement)})),this._cardImageElement.addEventListener("click",(()=>{this._handleImageClick({name:this._name,link:this._link})}))}}const t=document.querySelector(".profile__image"),r=document.querySelector("#profile-image-edit-modal"),i=document.querySelector("#profile-image-edit-form"),o=i.querySelector("#profile-image-edit-input"),n=i.querySelector("#profile-image-edit-button"),s=document.querySelector("#profile-edit-button"),l=document.querySelector("#profile-edit-modal"),a=document.querySelector("#profile-close-modal-button"),d=document.querySelector("#add-card-form"),c=document.querySelector(".profile__title"),u=document.querySelector(".profile__description"),m=document.querySelector("#profile-title-input"),p=document.querySelector("#profile-description-input"),h=d.querySelector("#modal-submit-create-button"),_=l.querySelector(".modal__form"),E=document.querySelector("#modal-card-delete-button"),f=document.querySelector("#delete-card-confirmation"),S=f.querySelector("#modal-card-delete-button"),v=document.querySelector(".card__delete-button-api"),y=document.querySelector(".profile__add-button"),b=document.querySelector("#card-add-modal"),C=b.querySelector(".modal__form"),g=document.querySelector("#popup-image"),I=document.querySelector(".modal__image"),k=document.querySelector(".modal__caption"),q=C.querySelector(".modal__input_type_title"),L=C.querySelector(".modal__input_type_link"),B={modalSubmitCreateButton:h,cardDeleteSubmitButton:document.querySelector(".modal__api").querySelector(".card__delete-button-api"),profileimageEditInput:o,profileImageEditForm:i,profileImageEditButton:n,profileImageEditModal:r,profileImage:t,deleteImageButton:v,modalDeleteCardConfirmation:S,deleteCardConfirmation:f,profileAddEditButton:s,profileEditModal:l,profileCloseModalButton:a,profileTitle:c,profileDescription:u,profileTitleInput:m,profileDescriptionInput:p,profileEditForm:_,addNewCardButton:y,cardAddModal:b,addCardFormElement:C,popupImageModal:g,modalImageElement:I,popupImageCaption:k,addCardForm:d,cardTitleInput:q,cardLinkInput:L,cardDeleteConfirmButton:E},T={profileTitle:B.profileTitle,profileDescription:B.profileDescription,profileTitleInput:B.profileTitleInput,profileDescriptionInput:B.profileDescriptionInput};window.domElements=B;var w={config:{formSelector:".modal__form",inputSelector:".modal__input",submitButtonSelector:".modal__submit",inactiveButtonClass:"modal__submit_disabled",inputErrorClass:"modal__input_type_error",errorClass:"modal__error_visible"},selectors:{cardSection:".cards__list",cardTemplate:".card-template"},domElements:B,infoSelector:T};class U{constructor(e,t){this._inputSelector=e.inputSelector,this._submitButtonSelector=e.submitButtonSelector,this._inactiveButtonClass=e.inactiveButtonClass,this._inputErrorClass=e.inputErrorClass,this._errorClass=e.errorClass,this._formElement=t}_showInputError(e){const t=this._formElement.querySelector(`#${e.id}-error`);e.classList.add(this._inputErrorClass),t.textContent=e.validationMessage,t.classList.add(this._errorClass)}_hideInputError(e){const t=this._formElement.querySelector(`#${e.id}-error`);e.classList.remove(this._inputErrorClass),t.classList.remove(this._errorClass),t.textContent=""}_checkInputValidity(e){e.validity.valid?this._hideInputError(e):this._showInputError(e)}_toggleButtonState(e){const t=this._formElement.querySelector(this._submitButtonSelector);this._hasInvalidInput(e)?this.disableButton():(t.classList.remove(this._inactiveButtonClass),t.disabled=!1)}_hasInvalidInput(e){return!e.every((e=>e.validity.valid))}_setEventListeners(){this._inputEls=[...this._formElement.querySelectorAll(this._inputSelector)],this._inputEls.forEach((e=>{e.addEventListener("input",(()=>{this._checkInputValidity(e),this._toggleButtonState(this._inputEls)}))}))}disableButton(){const e=this._formElement.querySelector(this._submitButtonSelector);this._formElement.addEventListener("submit",(()=>{e.classList.add(this._inactiveButtonClass),e.disabled=!0}))}enableValidation(){this._formElement.addEventListener("submit",(e=>{e.preventDefault()})),this._setEventListeners()}resetValidation(){this._inputEls.forEach((e=>{this._hideInputError(e),e.value=""})),this.disableButton()}}class A{constructor(e){let{popupSelector:t}=e;this.popupElement=document.querySelector(t),this._handleEscClose=this._handleEscClose.bind(this),this._handleOverlayClick=this._handleOverlayClick.bind(this),this._handleCloseClick=()=>this.close()}setEventListeners(){this.popupElement.querySelector(".modal__close").addEventListener("click",this._handleCloseClick)}open(){this.popupElement.classList.add("modal_opened"),document.addEventListener("keydown",this._handleEscClose),document.addEventListener("click",this._handleOverlayClick)}close(){this.popupElement.classList.remove("modal_opened"),document.removeEventListener("keydown",this._handleEscClose),document.removeEventListener("click",this._handleOverlayClick)}_handleEscClose(e){"Escape"===e.key&&this.close()}_handleOverlayClick(e){e.target.classList.contains("modal_opened")&&this.close()}}class D extends A{constructor(e,t){let{popupSelector:r}=e;super({popupSelector:r}),this._handleFormSubmit=t,this._form=this.popupElement.querySelector(".modal__form"),this._getInputValues=this._getInputValues.bind(this)}_getInputValues(){const e=Array.from(this.popupElement.querySelectorAll(".modal__input")),t={};return e.forEach((e=>{t[e.name]=e.value})),t}}const{domElements:x,selectors:F,config:$}=w,V=new class{constructor(e,t,r,i){let{items:o,renderer:n}=e;this._items=o,this._renderer=n,this._container=document.querySelector(t),this.domElements=r,this.generateCard=i}renderItems(e){e.forEach((e=>{this._renderer(e)}))}addItem(e){this._container.append(e)}}({items:[],renderer:e=>{const t=z(e);V.addItem(t)}},F.cardSection,x,z),R=new U($,x.addCardFormElement),O=new U($,x.profileEditForm),N=new D({popupSelector:"#delete-card-confirmation"}),M=new D({popupSelector:"#profile-image-edit-modal"}),j=new class extends A{constructor(e,t){let{popupSelector:r}=e;super({popupSelector:r}),this._domElements=t}open(e){let{name:t,link:r}=e;const i=this._domElements.modalImageElement,o=this._domElements.popupImageCaption;i.src=r,i.alt=t,o.textContent=t,super.open()}}({popupSelector:"#popup-image"},x),P=new D({popupSelector:"#card-add-modal"},K,x,$),J=new D({popupSelector:"#profile-edit-modal"},(e=>{let{name:t,description:r}=e;G.setUserInfo(t,r),J.close()}),x,$),G=new class{constructor(e,t,r){this._nameElement=document.querySelector(e),this._jobElement=document.querySelector(t),this.domElements=r}getUserInfo(){return{title:this._nameElement.textContent,description:this._jobElement.textContent}}setUserInfo(e,t){this._nameElement.textContent=e,this._jobElement.textContent=t}}(".profile__title",".profile__description",x);R.enableValidation(),O.enableValidation();const H=e=>{let{name:t,link:r}=e;j.open({name:t,link:r})};function z(t){const r=new e(t,"#card-template",H,x,(()=>{return e=t._id,i=r._cardElement,N.open(),void x.cardDeleteConfirmButton.addEventListener("click",(()=>{var t,r;t=e,r=i,W.deleteCard(t).then((()=>{r.remove()})).catch((e=>{console.error("Error deleting card:",e)})),N.close()}),{once:!0});var e,i}),(()=>W.toggleLike(t._id,r._cardElement)));return r.getView()}function K(e){let{name:t,link:r}=e;const i=z({name:t,link:r});V.addItem(i),P.close(),setTimeout((()=>{x.addCardFormElement.reset()}),1)}function Q(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"Saving...";const i=t.name;e?t.textContent=r:setTimeout((()=>{t.textContent=i}),500)}x.profileImage.addEventListener("click",(()=>{M.open(),x.profileImageEditForm.addEventListener("submit",(e=>{e.preventDefault();const t=x.profileimageEditInput.value,r=x.profileImageEditButton;Q(!0,r),W.updateApiUserAvatar(t).then((e=>{x.profileImage.src=t,x.profileImageEditModal.classList.remove("modal_opened")})).catch((e=>{console.error("Error updating profile image:",e)})).finally((()=>{setTimeout((()=>{Q(!1,r)}),100)}))}))})),x.profileAddEditButton.addEventListener("click",(()=>{const e=G.getUserInfo();x.profileTitleInput.value=e.title,x.profileDescriptionInput.value=e.description,J.open()})),x.addNewCardButton.addEventListener("click",(()=>{P.open()})),P.setEventListeners(),J.setEventListeners(),j.setEventListeners(),N.setEventListeners(),M.setEventListeners();const W=new class{constructor(e){let{baseUrl:t,headers:r}=e;this.baseUrl=t,this.headers=r,this._handleResponse=this._handleResponse.bind(this)}getApiInitialCards(){return fetch(`${this.baseUrl}/cards`,{method:"GET",headers:this.headers}).then(this._handleResponse)}getApiUserInfo(){return fetch(`${this.baseUrl}/users/me`,{method:"GET",headers:this.headers}).then(this._handleResponse)}addApiNewCard(e){return fetch(`${this.baseUrl}/cards`,{method:"POST",headers:this.headers,body:JSON.stringify(e)}).then(this._handleResponse)}addApiUserInfo(e){return fetch(`${this.baseUrl}/users/me`,{method:"PATCH",headers:this.headers,body:JSON.stringify(e)}).then(this._handleResponse)}updateApiUserAvatar(e){return fetch(`${this.baseUrl}/users/me/avatar`,{method:"PATCH",headers:this.headers,body:JSON.stringify({avatar:e})}).then(this._checkResponse)}deleteCard(e){return fetch(`${this.baseUrl}/cards/${e}`,{method:"DELETE",headers:this.headers}).then(this._handleResponse)}toggleLike(e,t){const r=t.querySelector(".card__description").querySelector(".card__like-button"),i=r.classList.contains("card__like-button_active"),o=i?"DELETE":"PUT";return i?r.classList.remove("card__like-button_active"):r.classList.add("card__like-button_active"),fetch(`${this.baseUrl}/cards/${e}/likes`,{method:o,headers:this.headers}).then(this._handleResponse)}_handleResponse(e){return e.ok?e.json():Promise.reject(`Error: ${e.status}`)}}({baseUrl:"https://around-api.en.tripleten-services.com/v1",headers:{authorization:"7475a3c0-00b4-4b01-93e9-2c093b2534fb","Content-Type":"application/json"}},x);W.getApiUserInfo().then((e=>{document.querySelector(".profile__title").textContent=e.name,document.querySelector(".profile__description").textContent=e.about,document.querySelector(".profile__image").src=e.avatar})).catch((e=>{console.error("Failed to load user info:",e)})),W.getApiInitialCards().then((e=>{V.renderItems(e)})).catch((e=>{console.error("Error Found:",e)})),x.profileEditForm.addEventListener("submit",(e=>{const t={name:x.profileTitleInput.value,about:x.profileDescriptionInput.value};W.addApiUserInfo(t).then((e=>{document.querySelector(".profile__title").textContent=e.name,document.querySelector(".profile__description").textContent=e.about})).catch((e=>{console.error("Error updating profile:",e)})),J.close()})),x.addCardForm.addEventListener("submit",(()=>{Q(!0,x.modalSubmitCreateButton);const e={name:x.cardTitleInput.value,link:x.cardLinkInput.value};W.addApiNewCard(e).then((e=>{K(e)})).catch((e=>{console.error("Error adding new card:",e)})),P.close(),Q(!1,x.modalSubmitCreateButton)}))}();
//# sourceMappingURL=main.js.map